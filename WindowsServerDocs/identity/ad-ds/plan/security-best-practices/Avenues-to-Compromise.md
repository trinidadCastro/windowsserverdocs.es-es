---
ms.assetid: d7a4d2e1-217d-4ffc-93f0-817149bd9e7f
title: Vías de compromiso
author: iainfoulds
ms.author: daveba
manager: daveba
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: 58578d96f3a66177f858f78861cb93be51df3a1e
ms.sourcegitcommit: b115e5edc545571b6ff4f42082cc3ed965815ea4
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/30/2020
ms.locfileid: "93069687"
---
# <a name="avenues-to-compromise"></a>Vías de compromiso

>Se aplica a: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

*Número de ley siete: la red más segura es una administrada correctamente.* - [10 leyes inmutables de administración de seguridad](/previous-versions/cc722488(v=technet.10))

En las organizaciones que han experimentado eventos de riesgo catastróficos, las evaluaciones suelen revelar que las organizaciones tienen una visibilidad limitada del estado real de sus infraestructuras de ti, que pueden diferir significativamente de sus Estados "como documentados". Estas desviaciones presentan vulnerabilidades que exponen el entorno al riesgo, a menudo con poco riesgo de detección hasta que el compromiso ha progresado hasta el punto en el que los atacantes "poseen" el entorno.

Las evaluaciones detalladas de la configuración AD DS de estas organizaciones, las infraestructuras de clave pública (PKI), los servidores, las estaciones de trabajo, las aplicaciones, las listas de control de acceso (ACL) y otras tecnologías muestran configuraciones incompletas y vulnerabilidades que, si se corrige, podrían haber impedido el riesgo inicial.

El análisis de la documentación, los procesos y los procedimientos de ti identifica las vulnerabilidades introducidas por brechas en las prácticas administrativas aprovechadas por los atacantes para obtener los privilegios que se usaron para poner en peligro el bosque de Active Directory. Un bosque totalmente comprometido es aquél en el que los atacantes no solo ponen en peligro las cuentas de usuario, las aplicaciones o los sistemas individuales, sino que escalan su acceso para obtener un nivel de privilegio en el que pueden modificar o destruir todos los aspectos del bosque. Cuando una instalación Active Directory se ve comprometida a ese grado, los atacantes pueden realizar cambios que les permitan mantener una presencia en todo el entorno, o peor, para destruir el directorio y los sistemas y las cuentas que administra.

Aunque una serie de las vulnerabilidades que se aprovechan normalmente en las descripciones que se indican a continuación no son ataques contra Active Directory, permiten a los atacantes establecer una asignación en un entorno que se puede usar para ejecutar ataques de escalado de privilegios (también denominado elevación de privilegios) y, en última instancia, dirigirse a AD DS.

Esta sección de este documento se centra en describir los mecanismos que los atacantes utilizan normalmente para obtener acceso a la infraestructura y finalmente para iniciar ataques de elevación de privilegios. Consulte también las siguientes secciones:

-   [Reducción de la superficie expuesta a ataques de Active Directory](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md) Recomendaciones detalladas para la configuración segura de Active Directory.

-   [Supervisión Active Directory los síntomas de riesgo](../../../ad-ds/plan/security-best-practices/Monitoring-Active-Directory-for-Signs-of-Compromise.md) Recomendaciones para ayudar a detectar riesgos

-   [Planeación del riesgo](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Planning-for-Compromise.md) Enfoques de alto nivel para ayudar a preparar los ataques contra la infraestructura desde las perspectivas empresariales y de ti

> [!NOTE]
> Aunque este documento se centra en Active Directory y en los sistemas de Windows que forman parte de un dominio AD DS, los atacantes raramente se centran únicamente en Active Directory y Windows. En entornos con una mezcla de sistemas operativos, directorios, aplicaciones y repositorios de datos, es habitual encontrar que los sistemas que no son de Windows también se han puesto en peligro. Esto es especialmente cierto si los sistemas proporcionan un "puente" entre entornos Windows y otros que no son de Windows, como los servidores de archivos a los que tienen acceso los clientes de Windows y UNIX o Linux, los directorios que proporcionan servicios de autenticación a varios sistemas operativos, o los Metadirectorios que sincronizan los datos entre distintos directorios.
>
> AD DS se dirige debido a las capacidades de administración de acceso y configuración centralizadas que proporciona no solo a los sistemas Windows, sino también a otros clientes. Cualquier otro directorio o aplicación que proporcione servicios de administración de configuración y autenticación puede, y se dirigirá a los atacantes determinados. Aunque este documento se centra en protecciones que pueden reducir la probabilidad de poner en peligro las instalaciones de Active Directory, todas las organizaciones que incluyen equipos, directorios, aplicaciones o repositorios de datos que no son de Windows también deben prepararse para los ataques contra esos sistemas.

## <a name="initial-breach-targets"></a>Objetivos de infracción inicial
Nadie crea intencionadamente una infraestructura de ti que exponga la organización en peligro. Cuando se crea por primera vez un bosque de Active Directory, suele ser original y actual. A medida que se pasan años y se adquieren nuevos sistemas operativos y aplicaciones, se agregan al bosque. A medida que se reconocen las ventajas de capacidad de administración que proporciona Active Directory, se agregan más contenido al directorio, más personas integran sus equipos o aplicaciones con AD DS y los dominios se actualizan para admitir la nueva funcionalidad que ofrecen las versiones más recientes del sistema operativo Windows. Sin embargo, lo que sucede a lo largo del tiempo es que, incluso cuando se agrega una nueva infraestructura, es posible que no se mantengan otras partes de la infraestructura, así como que se encontraran inicialmente, que los sistemas y las aplicaciones funcionen correctamente y, por lo tanto, no estén recibiendo atención y las organizaciones no hayan eliminado su infraestructura heredada. En función de lo que vemos en la evaluación de infraestructuras en peligro, el entorno más antiguo, más grande y más complejo, lo más probable es que haya numerosas instancias de vulnerabilidades aprovechadas comúnmente.

Independientemente de la motivación del atacante, la mayoría de las infracciones de seguridad de la información comienzan con el riesgo de uno o dos sistemas a la vez. Estos eventos iniciales, o puntos de entrada en la red, suelen aprovechar las vulnerabilidades que podrían haberse corregido, pero no. El [Informe de investigación de infracciones de datos 2012 (DBIR)](http://www.verizonbusiness.com/resources/reports/rp_data-breach-investigations-report-2012_en_xg.pdf), que es un estudio anual producido por el equipo de riesgo de Verizon en cooperación con varias agencias de seguridad nacionales y otras empresas, indica que el 96 por ciento de los ataques fue "no muy difícil" y que "el 97% de las infracciones se evitaban mediante controles simples o intermedios". Estos hallazgos pueden ser una consecuencia directa de las vulnerabilidades aprovechadas normalmente que se indican a continuación.

### <a name="gaps-in-antivirus-and-antimalware-deployments"></a>Brechas en las implementaciones de antivirus y antimalware
*Número de ley ocho: un escáner de malware obsoleto solo es marginalmente mejor que no tener ningún escáner.* - [Diez leyes inmutables de seguridad (versión 2,0)](https://www.microsoft.com/en-us/msrc?rtc=1)

El análisis de las implementaciones antivirus y antimalware de las organizaciones revela a menudo un entorno en el que la mayoría de las estaciones de trabajo están configuradas con software antivirus y antimalware habilitado y actualizado. Las excepciones suelen ser estaciones de trabajo que se conectan con poca frecuencia al entorno corporativo o a los dispositivos de los empleados para los que el software antivirus y antimalware puede ser difícil de implementar, configurar y actualizar.

Sin embargo, los rellenados de servidor tienden a estar menos protegidos en muchos entornos en peligro. Como se indica en las [2012 investigaciones de infracciones de datos](http://www.verizonbusiness.com/resources/reports/rp_data-breach-investigations-report-2012_en_xg.pdf), el 94 por ciento de todos los datos pone en peligro los servidores implicados, lo que representa un aumento del 18 por ciento del año anterior y el 69 por ciento de los ataques incorpora malware. En los rellenados de servidor, no es raro encontrar que las instalaciones de antivirus y antimalware estén configuradas de forma coherente, no actualizadas, mal configuradas o incluso deshabilitadas. En algunos casos, el software antivirus y antimalware está deshabilitado por el personal administrativo, pero, en otros casos, los atacantes deshabilitan el software después de poner en peligro un servidor a través de otras vulnerabilidades. Cuando se deshabilita el software antivirus y antimalware, los atacantes plantan el malware en el servidor y se centran en la propagación del riesgo en el rellenado del servidor.

No solo es importante asegurarse de que los sistemas están protegidos con la protección contra malware actual y completa, sino también de supervisar los sistemas para deshabilitar o quitar el software antivirus y antimalware y reiniciar automáticamente la protección cuando se deshabilita manualmente. Aunque ningún software antivirus y antimalware puede garantizar la prevención y detección de todas las infecciones, una implementación de antivirus y antimalware implementada y configurada correctamente puede reducir la probabilidad de infección.

### <a name="incomplete-patching"></a>Revisión incompleta
*Número de ley tres: Si no se mantiene al día con las correcciones de seguridad, la red no será suya durante mucho tiempo.* - [10 leyes inmutables de administración de seguridad](/previous-versions/cc722488(v=technet.10))

Microsoft publica los boletines de seguridad el segundo martes de cada mes, aunque en raras ocasiones se publican actualizaciones de seguridad entre las actualizaciones de seguridad mensuales (también conocidas como "actualizaciones fuera de banda") cuando se determina que la vulnerabilidad plantea un riesgo urgente para los sistemas de clientes. Si una pequeña empresa configura sus equipos Windows para que usen Windows Update para administrar la aplicación de revisiones del sistema y de las aplicaciones, o una organización grande usa software de administración, como Microsoft Endpoint Configuration Manager para implementar revisiones de acuerdo con los planes detallados, muchos clientes revisan sus infraestructuras de Windows de forma relativamente puntual.

Sin embargo, pocas infraestructuras incluyen solo equipos Windows y aplicaciones de Microsoft, y en entornos en peligro, es habitual encontrar que la estrategia de administración de revisiones de la organización contenga huecos. Los sistemas de Windows en estos entornos se revisan de forma incoherente. Los sistemas operativos que no son de Windows se revisan esporádicamente, si es que lo están. Las aplicaciones comerciales comerciales (COTS) contienen vulnerabilidades para las que existen revisiones, pero que no se han aplicado. Los dispositivos de red se configuran a menudo con credenciales predeterminadas de fábrica y no hay actualizaciones de firmware tras su instalación. Las aplicaciones y los sistemas operativos que ya no son compatibles con sus proveedores se mantienen en ejecución, a pesar de que ya no se pueden revisar contra las vulnerabilidades. Cada uno de estos sistemas sin revisión representa otro punto de entrada potencial para los atacantes.

La consumerización de ti ha introducido desafíos adicionales en que los dispositivos propiedad de los empleados se usan para acceder a los datos de propiedad de la empresa, y la organización puede tener poco o ningún control sobre la revisión y configuración de los dispositivos personales de los empleados. El hardware de clase empresarial normalmente se distribuye con opciones de configuración y administración de la empresa, a costa de menos elección en la personalización y selección de dispositivos individuales. El hardware centrado en los empleados ofrece una amplia gama de fabricantes, proveedores, características de seguridad de hardware, características de seguridad de software, capacidades de administración y opciones de configuración, y muchas de las características empresariales pueden estar ausentes por completo.

#### <a name="patch-and-vulnerability-management-software"></a>Software de administración de revisiones y vulnerabilidades
Si se ha implementado un sistema de administración de revisiones eficaz para los sistemas de Windows y las aplicaciones de Microsoft, parte de la superficie expuesta a ataques que crean las vulnerabilidades no revisadas se ha solucionado. Sin embargo, a menos que los sistemas que no son de Windows, las aplicaciones que no son de Microsoft, la infraestructura de red y los dispositivos de empleados también se mantengan actualizados en las revisiones y otras correcciones, la infraestructura sigue siendo vulnerable. En algunos casos, el proveedor de una aplicación puede ofrecer funcionalidades de actualización automática. en otros, puede que sea necesario diseñar un enfoque para recuperar y aplicar revisiones y otras correcciones con regularidad.

### <a name="outdated-applications-and-operating-systems"></a>Aplicaciones y sistemas operativos obsoletos
*"No puede esperar un sistema operativo de seis años para protegerle contra un ataque de seis meses."* -Profesional de seguridad de la información con 10 años de experiencia en la protección de instalaciones empresariales

Aunque "obtener actual, mantenerse actualizado" puede parecer una frase de marketing, los sistemas operativos y las aplicaciones anticuados crean un riesgo en las infraestructuras de TI de muchas organizaciones. Un sistema operativo que se lanzó en 2003 podría seguir siendo compatible con el proveedor y proporcionarse con actualizaciones para solucionar las vulnerabilidades, pero ese sistema operativo podría no contener características de seguridad agregadas en las versiones más recientes del sistema operativo. Los sistemas anticuados incluso pueden requerir la debilitación de ciertas AD DS configuración de seguridad para admitir las menos funciones de esos equipos.

Las aplicaciones que se escribieron para usar protocolos de autenticación heredados por proveedores que ya no son compatibles con la aplicación normalmente no se pueden reutilizar para admitir mecanismos de autenticación más seguros. Sin embargo, es posible que el dominio de Active Directory de una organización se siga configurando para almacenar los hashes de LAN Manager o las contraseñas cifradas de manera reversible para admitir estas aplicaciones. Es posible que las aplicaciones escritas antes de la introducción de los sistemas operativos más recientes no funcionen bien o en absoluto en los sistemas operativos actuales, lo que obliga a que las organizaciones mantengan sistemas antiguos y antiguos, y en algunos casos, hardware y software completamente incompatible.

Incluso en los casos en que las organizaciones han actualizado sus controladores de dominio a Windows Server 2012, Windows Server 2008 R2 o Windows Server 2008, es habitual encontrar partes significativas del rellenado de servidores miembro para ejecutar Windows Server 2003, Windows 2000 Server o Windows NT Server 4,0 (que no son totalmente compatibles). Cuanto más larga sea una organización que mantenga los sistemas antiguos, mayor será la disparidad entre los conjuntos de características y más probabilidades de que los sistemas de producción no se admitan. Además, cuanto más tiempo se mantiene un bosque Active Directory, más observamos que los sistemas y las aplicaciones heredados no se encuentran en los planes de actualización. Esto puede significar que un único equipo que ejecuta una sola aplicación puede introducir vulnerabilidades en todo el dominio o en todo el bosque porque Active Directory está configurado para admitir los protocolos heredados y los mecanismos de autenticación.

Para eliminar sistemas y aplicaciones heredados, primero debe centrarse en identificarlos y catalogarlos y, a continuación, decidir si actualizar o reemplazar la aplicación o el host. Aunque puede ser difícil encontrar reemplazos para aplicaciones muy especializadas para las que no hay ninguna compatibilidad ni una ruta de actualización, es posible que pueda aprovechar un concepto denominado "destrucción creativa" para reemplazar la aplicación heredada por una nueva aplicación que proporcione la funcionalidad necesaria. La [planeación del riesgo](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Planning-for-Compromise.md) se describe con más detalle en "planear el riesgo" más adelante en este documento.

### <a name="misconfiguration"></a>Error de configuración
*Número de ley cuatro: no hace mucho bueno instalar las correcciones de seguridad en un equipo que nunca se protegió para comenzar.* - [10 leyes inmutables de administración de seguridad](/previous-versions/cc722488(v=technet.10))

Incluso en entornos en los que los sistemas suelen mantenerse actualizados y revisarse, normalmente se identifican brechas o configuraciones incoherentes en el sistema operativo, las aplicaciones que se ejecutan en los equipos y Active Directory. Algunas configuraciones incompletas exponen solo el equipo local en peligro, pero después de que un equipo se "posee", los atacantes suelen centrarse en la propagación adicional del riesgo en otros sistemas y, finalmente, en Active Directory. A continuación se muestran algunas de las áreas comunes en las que se identifican las configuraciones que presentan riesgos.

#### <a name="in-active-directory"></a>En Active Directory
Las cuentas de Active Directory que son más comunes para los atacantes son las que son miembros de los grupos con más privilegios, como los miembros de los grupos Admins. del dominio (DA), administradores de empresas (EA) o administradores integrados (BA) en Active Directory. La pertenencia de estos grupos debe reducirse al menor número posible de cuentas para que la superficie expuesta a ataques de estos grupos sea limitada. Incluso es posible eliminar la pertenencia "permanente" en estos grupos con privilegios; es decir, puede implementar la configuración que le permite rellenar temporalmente estos grupos solo cuando se necesitan sus privilegios de dominio y de todo el bosque. Cuando se usan cuentas con privilegios elevados, deben usarse solo en sistemas designados y seguros, como controladores de dominio o hosts administrativos seguros. En [la reducción de la superficie expuesta a ataques de Active Directory](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)se proporciona información detallada para ayudar a implementar todas estas configuraciones.

Cuando se evalúa la pertenencia de los grupos con más privilegios en Active Directory, normalmente encontramos una pertenencia excesiva en los tres grupos con más privilegios. En algunos casos, las organizaciones tienen docenas, incluso cientos de cuentas en grupos de DA. En otros casos, las organizaciones colocan cuentas directamente en grupos de administradores integrados, pensando que el grupo tiene "menos privilegios" que el grupo DAs. No lo es. A menudo, encontramos algunos miembros permanentes del grupo EA en el dominio raíz del bosque, a pesar de que los privilegios de EA rara vez se requieren de forma temporal. La búsqueda de la cuenta administrativa diaria de un usuario de TI en los tres grupos también es común, aunque se trata de una configuración con redundancia eficaz. Tal y como se describe en [reducir la superficie](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)expuesta a ataques de Active Directory, si una cuenta es miembro permanente de uno de estos grupos o de todos ellos, la cuenta puede usarse para poner en peligro e incluso destruir el entorno de AD DS y los sistemas y cuentas administrados por él. Se proporcionan recomendaciones para la configuración segura y el uso de cuentas con privilegios en Active Directory para [reducir la superficie expuesta a ataques de Active Directory](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md).

#### <a name="on-domain-controllers"></a>En controladores de dominio
Cuando se evalúan los controladores de dominio, a menudo se encuentran configurados y administrados de forma diferente a los servidores miembro. A veces, los controladores de dominio ejecutan las mismas aplicaciones y utilidades instaladas en los servidores miembro, no porque son necesarios en los controladores de dominio, pero debido a que las aplicaciones forman parte de una compilación estándar. Estas aplicaciones pueden proporcionar una funcionalidad mínima en los controladores de dominio, pero se agregan de manera significativa a su superficie expuesta a ataques al requerir un valor de configuración que abra puertos, cree cuentas de servicio con privilegios elevados o conceda acceso al sistema por parte de usuarios que no deben conectarse a un controlador de dominio para ningún propósito distinto de la autenticación y directiva de grupo aplicación. En algunas brechas, los atacantes han utilizado herramientas que ya estaban instaladas en los controladores de dominio no solo para obtener acceso a los controladores de dominio, sino para modificar o dañar la base de datos de AD DS.

Cuando se extraen los valores de configuración de Internet Explorer en los controladores de dominio, encontramos que los usuarios han iniciado sesión con cuentas que tienen altos niveles de privilegio en Active Directory y que han usado las cuentas para tener acceso a Internet y a la intranet desde los controladores de dominio. En algunos casos, las cuentas han configurado la configuración de Internet Explorer en los controladores de dominio para permitir la descarga de contenido de Internet y las utilidades de freeware se han descargado de los sitios de Internet y se han instalado en los controladores de dominio. La configuración de seguridad mejorada de Internet Explorer está habilitada para usuarios y administradores de forma predeterminada, pero a menudo observamos que se ha deshabilitado para los administradores. Cuando una cuenta con privilegios elevados accede a Internet y descarga contenido en cualquier equipo, el equipo se pone en riesgo grave. Cuando el equipo es un controlador de dominio, toda la instalación de AD DS se pone en riesgo.

##### <a name="protecting-domain-controllers"></a>Protección de controladores de dominio
Los controladores de dominio se deben tratar como componentes de infraestructura críticos, se protegen más rigurosamente y se configuran de forma más rígida que los servidores de archivos, impresión y aplicaciones. Los controladores de dominio no deben ejecutar ningún software que no sea necesario para que el controlador de dominio funcione o no proteja el controlador de dominio frente a ataques. Los controladores de dominio no deben tener permiso de acceso a Internet, por lo que los objetos directiva de grupo (GPO) deben configurar y aplicar la configuración de seguridad. Se proporcionan recomendaciones detalladas para la instalación segura, la configuración y la administración de controladores de dominio en la [protección de los controladores de dominio frente a ataques](../../../ad-ds/plan/security-best-practices/Securing-Domain-Controllers-Against-Attack.md).

#### <a name="within-the-operating-system"></a>En el sistema operativo
*Número de ley: Si un intruso puede modificar el sistema operativo del equipo, ya no es el equipo.* - [Diez leyes inmutables de seguridad (versión 2,0)](https://www.microsoft.com/en-us/msrc?rtc=1)

Aunque algunas organizaciones crean configuraciones de línea de base para servidores de tipos diferentes y permiten una personalización limitada del sistema operativo después de su instalación, el análisis de entornos en peligro a menudo detecta un gran número de servidores implementados de forma ad hoc y configurados de forma manual e independiente. Las configuraciones entre dos servidores que realizan la misma función pueden ser completamente diferentes, donde ningún servidor se configura de forma segura. Por el contrario, las líneas de base de configuración del servidor se pueden aplicar de forma coherente, pero también se configuran de forma coherente. es decir, los servidores se configuran de una manera que crea la misma vulnerabilidad en todos los servidores de un tipo determinado. La configuración inestable incluye prácticas como la deshabilitación de las características de seguridad, la concesión de derechos y permisos excesivos a las cuentas (especialmente las cuentas de servicio), el uso de credenciales locales idénticas en todos los sistemas y la habilitación de la instalación de aplicaciones y utilidades no autorizadas que crean vulnerabilidades propias.

##### <a name="disabling-security-features"></a>Deshabilitar las características de seguridad
A veces, las organizaciones deshabilitan Firewall de Windows con seguridad avanzada (WFAS) de la creencia de que el WFAS es difícil de configurar o requiere una configuración que consume muchos recursos. Sin embargo, a partir de Windows Server 2008, cuando cualquier rol o característica está instalado en un servidor, se configura de forma predeterminada con los privilegios mínimos necesarios para que el rol o la característica funcionen, y el Firewall de Windows se configura automáticamente para admitir el rol o la característica. Al deshabilitar WFAS (y no usar otro Firewall basado en host en su lugar), las organizaciones aumentan la superficie expuesta a ataques de todo el entorno de Windows. Los firewalls perimetrales proporcionan cierta protección contra los ataques que se dirigen directamente a un entorno desde Internet, pero no proporcionan ninguna protección contra los ataques que aprovechan otros vectores de ataque, como los ataques [por descarga](https://www.microsoft.com/security/sir/glossary/drive-by-download-sites.aspx) de la unidad o los ataques que se originan en otros sistemas en peligro en la intranet.

La configuración de control de cuentas de usuario (UAC) a veces está deshabilitada en los servidores porque el personal administrativo encuentra los mensajes intrusivos. Aunque [soporte técnico de Microsoft artículo 2526083](https://support.microsoft.com/kb/2526083) describe los escenarios en los que UAC puede estar deshabilitado en Windows Server, a menos que esté ejecutando una instalación Server Core (donde UAC esté deshabilitado por diseño), no debe deshabilitar UAC en servidores sin tener en cuenta la consideración e investigación.

En otros casos, la configuración del servidor se establece en valores menos seguros porque las organizaciones aplican opciones de configuración de servidor obsoletas a los nuevos sistemas operativos, como la aplicación de líneas base de Windows Server 2003 a equipos que ejecutan Windows Server 2012, Windows Server 2008 R2 o Windows Server 2008, sin cambiar las líneas base para reflejar los cambios en el sistema operativo. En lugar de llevar las líneas de base de servidor antiguas a los nuevos sistemas operativos, al implementar un nuevo sistema operativo, revise los cambios de seguridad y la configuración para asegurarse de que la configuración implementada sea aplicable y adecuada para el nuevo sistema operativo.

##### <a name="granting-excessive-privilege"></a>Concesión de privilegios excesivos
En casi todos los entornos que hemos evaluado, se conceden privilegios excesivos a las cuentas locales y basadas en dominio en los sistemas Windows. A los usuarios se les conceden derechos de administrador local en sus estaciones de trabajo, los servidores miembro ejecutan servicios que están configurados con derechos más allá de lo que necesitan para funcionar y los grupos de administradores locales en el rellenado del servidor contienen docenas o incluso centenares de cuentas locales y de dominio. Poner en peligro solo una cuenta con privilegios en un equipo permite a los atacantes poner en peligro las cuentas de todos los usuarios y servicios que inician sesión en el equipo, así como recopilar y aprovechar las credenciales para propagar el riesgo a otros sistemas.

Aunque Pass-The-hash (PTH) y otros ataques de robo de credenciales están omnipresentes hoy en día, es porque hay herramientas de disponibilidad gratuita que facilitan y simplifican la extracción de las credenciales de otras cuentas con privilegios cuando un atacante ha obtenido acceso de nivel de administrador o de sistema a un equipo. Incluso sin las herramientas que permiten la recopilación de credenciales de sesiones de inicio de sesión, un atacante con privilegios de acceso a un equipo puede instalar fácilmente los registradores de pulsaciones de teclas que capturan pulsaciones de teclas, capturas de pantallas y contenido del portapapeles. Un atacante con privilegios de acceso a un equipo puede deshabilitar el software antimalware, instalar rootkits, modificar archivos protegidos o instalar malware en el equipo que automatiza los ataques o convierte un servidor en una [unidad-por](https://www.microsoft.com/security/sir/glossary/drive-by-download-sites.aspx) host de descarga.

Las tácticas que se usan para ampliar una brecha más allá de un solo equipo varían, pero la clave para propagar el riesgo es la adquisición de acceso con privilegios elevados a sistemas adicionales. Al reducir el número de cuentas con acceso con privilegios a cualquier sistema, se reduce la superficie expuesta a ataques no solo de ese equipo, sino que la probabilidad de que un atacante recopile credenciales valiosas del equipo.

##### <a name="standardizing-local-administrator-credentials"></a>Estandarizar credenciales de administrador local
Ha habido mucho debate entre los especialistas de seguridad en cuanto a si se produce un valor al cambiar el nombre de las cuentas de administrador local en equipos Windows. Lo que realmente es importante sobre las cuentas de administrador local es si están configurados con el mismo nombre de usuario y contraseña en varios equipos.

Si la cuenta de administrador local tiene el mismo valor en todos los servidores y la contraseña asignada a la cuenta también se configura en el mismo valor, los atacantes pueden extraer las credenciales de la cuenta en un equipo en el que se haya obtenido acceso de nivel de sistema o administrador. El atacante no tiene que poner en peligro inicialmente la cuenta de administrador; solo deben poner en peligro la cuenta de un usuario que sea miembro del grupo local Administradores o de una cuenta de servicio configurada para ejecutarse como LocalSystem o con privilegios de administrador. A continuación, el atacante puede extraer las credenciales de la cuenta de administrador y reproducir esas credenciales en los inicios de sesión de red en otros equipos de la red.

Siempre que otro equipo tenga una cuenta local con el mismo nombre de usuario y contraseña (o hash de contraseña) que las credenciales de cuenta que se van a presentar, el intento de inicio de sesión se realiza correctamente y el atacante obtiene acceso con privilegios al equipo de destino. En las versiones actuales de Windows, la cuenta predefinida Administrador está [deshabilitada de forma predeterminada](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753450(v=ws.11)), pero en los sistemas operativos heredados, la cuenta está habilitada de forma predeterminada.

> [!NOTE]
> Algunas organizaciones han configurado intencionadamente cuentas de administrador local para que se habiliten en la creencia de que esto proporciona una "failsafe" en caso de que todas las demás cuentas con privilegios se bloqueen fuera de un sistema. Sin embargo, incluso si la cuenta de administrador local está deshabilitada y no hay ninguna otra cuenta disponible que pueda habilitar la cuenta o iniciar sesión en el sistema con privilegios de administrador, el sistema se puede arrancar en modo seguro y la cuenta de administrador local integrada se puede volver a habilitar, como se describe en [soporte técnico de Microsoft artículo 814777](https://support.microsoft.com/kb/814777). Además, si el sistema sigue aplicando correctamente los GPO, un GPO se puede modificar para volver a habilitar (temporalmente) la cuenta de administrador o se pueden configurar grupos restringidos para agregar una cuenta basada en dominio al grupo de administradores local. Se pueden realizar reparaciones y se puede volver a deshabilitar la cuenta de administrador. Para evitar de forma eficaz un compromiso lateral que use las credenciales de la cuenta de administrador local integrada, los nombres de usuario y contraseñas únicos deben configurarse para las cuentas de administrador local. Para implementar contraseñas únicas para cuentas de administrador local a través de un GPO, consulte [solución para la administración de la contraseña de la cuenta de administrador integrada a través de GPO](/previous-versions/mt227395(v=msdn.10)) en TechNet.  

##### <a name="permitting-installation-of-unauthorized-applications"></a>Permitir la instalación de aplicaciones no autorizadas
*Número de la ley: Si un usuario no válido puede persuadirle para que ejecute su programa en el equipo, ya no es el equipo.* - [Diez leyes inmutables de seguridad (versión 2,0)](https://www.microsoft.com/en-us/msrc?rtc=1)

Si una organización implementa una configuración de línea de base coherente entre servidores, no se debe permitir la instalación de aplicaciones que no formen parte de un rol definido por el servidor. Al permitir que se instale software que no forma parte de la funcionalidad designada del servidor, los servidores se exponen a una instalación accidental o malintencionada del software que aumenta la superficie expuesta a ataques del servidor, presenta vulnerabilidades de la aplicación o provoca inestabilidad en el sistema.

#### <a name="applications"></a>APLICACIONES
Tal y como se ha descrito anteriormente, las aplicaciones se instalan y configuran a menudo para usar cuentas a las que se les concede más privilegios de los que realmente requiere la aplicación. En algunos casos, la documentación de la aplicación especifica que las cuentas de servicio deben ser miembros del grupo de administradores locales de un servidor o que se deben configurar para que se ejecuten en el contexto de LocalSystem. Esto no suele ser debido a que la aplicación requiere esos derechos, pero dado que determinar qué derechos y permisos necesitan las cuentas de servicio de una aplicación, requiere una inversión en tiempo y esfuerzo adicionales. Si una aplicación no se instala con los privilegios mínimos necesarios para que la aplicación y sus características configuradas funcionen, el sistema se expone a los ataques que aprovechan los privilegios de aplicación sin que se produzca ningún ataque contra el propio sistema operativo.

### <a name="lack-of-secure-application-development-practices"></a>Falta de prácticas de desarrollo de aplicaciones seguras
Existe la infraestructura necesaria para admitir las cargas de trabajo empresariales. Cuando estas cargas de trabajo se implementan en aplicaciones personalizadas, es fundamental asegurarse de que las aplicaciones se desarrollan mediante procedimientos recomendados seguros. El análisis de la causa principal de los incidentes de toda la empresa a menudo revela que se produce un riesgo inicial a través de aplicaciones personalizadas, especialmente las que están orientadas a Internet. La mayoría de estos compromisos se logran a través de ataques conocidos, como los ataques de inyección de SQL (ciegas) y de scripting entre sitios (XSS).

La inyección de SQL es una vulnerabilidad de aplicación que permite a la entrada definida por el usuario modificar una instrucción SQL que se pasa a la base de datos para su ejecución. Esta entrada se puede proporcionar a través de un campo de la aplicación, un parámetro (como la cadena de consulta o una cookie) u otros métodos. El resultado de esta inyección es que la instrucción SQL proporcionada a la base de datos es fundamentalmente diferente de lo que el desarrollador pretendía. Tomemos, por ejemplo, una consulta común que se usa en la evaluación de una combinación de nombre de usuario/contraseña:

`SELECT userID FROM users WHERE username = 'sUserName' AND password = 'sPassword'`

Cuando lo recibe el servidor de base de datos, indica al servidor que busque en la tabla usuarios y devuelva cualquier registro userID donde el nombre de usuario y la contraseña coincidan con los proporcionados por el usuario (presumiblemente a través de un formulario de inicio de sesión de algún tipo). Naturalmente, la intención del Desarrollador en este caso es devolver solo un registro válido si el usuario puede proporcionar un nombre de usuario y una contraseña correctos. Si uno de los dos es incorrecto, el servidor de base de datos no podrá encontrar ningún registro coincidente y devolverá un resultado vacío.

El problema se produce cuando un atacante realiza algo inesperado, como proporcionar su propio SQL en lugar de datos válidos. Dado que el servidor de base de datos interpreta SQL en la marcha, el código insertado se procesaría como si el desarrollador hubiera colocado por sí mismo. Por ejemplo, si el atacante entró en **Administrador** para el ID. de usuario y **XYZ** o **1 = 1** como contraseña, la instrucción resultante procesada por la base de datos sería:

`SELECT userID FROM users WHERE username = 'administrator' AND password = 'xyz' OR 1=1`

Cuando el servidor de base de datos procesa esta consulta, todas las filas de la tabla se devolverán en la consulta porque 1 = 1 siempre se evaluará como true, por lo que no importa si se conoce o se proporciona el nombre de usuario y la contraseña correctos. El resultado neto en la mayoría de los casos es que el usuario iniciará sesión como el primer usuario en la base de datos del usuario. en la mayoría de los casos, este será el usuario administrativo.

Además de simplemente iniciar sesión, se pueden usar instrucciones SQL con un formato incorrecto como esta para agregar, eliminar o cambiar datos, o incluso quitar (eliminar) tablas completas de una base de datos. En los casos más extremos en los que ciegas se combina con un exceso de privilegios, se pueden ejecutar comandos del sistema operativo para permitir la creación de nuevos usuarios, descargar herramientas de ataque o realizar cualquier otra acción de los atacantes que elijan.

En el scripting entre sitios, la vulnerabilidad se introduce en la salida de la aplicación. Un ataque comienza con un atacante que proporciona datos incorrectos a la aplicación, pero en este caso los datos con formato incorrecto están en forma de código de scripting (como JavaScript) que se ejecutará en el explorador de la víctima. El aprovechamiento de una vulnerabilidad de XSS puede permitir que un atacante ejecute cualquier función de la aplicación de destino en el contexto del usuario que inició el explorador. Los ataques XSS normalmente se inician mediante un correo electrónico de suplantación de identidad (phishing) que anima al usuario a hacer clic en un vínculo que se conecta a la aplicación y ejecuta el código de ataque.

XSS se suele aprovechar en los escenarios de comercio electrónico y banca en línea, donde un atacante puede realizar compras o transferir dinero en el contexto del usuario atacado. En el caso de un ataque de destino en una aplicación personalizada de administración de identidades basada en Web, puede permitir a un atacante crear sus propias identidades, modificar permisos y derechos y conducir a un riesgo sistémico.

Aunque una discusión completa de las secuencias de comandos entre sitios y la inyección de SQL está fuera del ámbito de este documento, el [proyecto abierto de seguridad de aplicaciones web (OWASP)](https://www.owasp.org/index.php/Main_Page) publica una lista de 10 principales con una explicación detallada de las vulnerabilidades y contramedidas.

Independientemente de la inversión en la seguridad de la infraestructura, si se implementan aplicaciones mal diseñadas y escritas dentro de esa infraestructura, el entorno se hace vulnerable a los ataques. Incluso las infraestructuras bien protegidas no suelen proporcionar contramedidas eficaces a estos ataques de aplicaciones. En cuanto al problema, las aplicaciones diseñadas incorrectamente pueden requerir que se concedan permisos excesivos a las cuentas de servicio para que la aplicación funcione.

La Ciclo de vida de desarrollo de seguridad (SDL) de Microsoft es un conjunto de controles de proceso estructural que funcionan para mejorar la seguridad a partir de principios de recopilación y ampliación del ciclo de vida de la aplicación hasta que se retiran. Esta integración de controles de seguridad eficaces no solo es fundamental desde el punto de vista de la seguridad, sino que es fundamental asegurarse de que la seguridad de la aplicación sea costosa y sea efectiva. La evaluación de una aplicación para los problemas de seguridad cuando se completa realmente el código requiere que las organizaciones tomen decisiones sobre la seguridad de la aplicación solo antes o después de implementar la aplicación. Una organización puede optar por solucionar los errores de la aplicación antes de implementar la aplicación en producción, incurrir en costos y retrasos, o la aplicación se puede implementar en producción con defectos de seguridad conocidos, lo que expone a la organización en peligro.

Algunas organizaciones colocan el costo total de corregir un problema de seguridad en el código de producción por encima de $10.000 por problema, y las aplicaciones desarrolladas sin un SDL eficaz pueden calcular un promedio de más de diez problemas de gravedad alta por cada 100.000 líneas de código. En aplicaciones de gran tamaño, los costos se escalan rápidamente. Por el contrario, muchas empresas establecen una prueba comparativa de menos de un problema por 100.000 líneas de código en la etapa final de la revisión de código de SDL y pretenden tener cero problemas en aplicaciones de alto riesgo en producción.

La implementación de SDL mejora la seguridad al incluir los requisitos de seguridad en una fase temprana de la recopilación y el diseño de una aplicación, lo que proporciona un modelado de amenazas para aplicaciones de alto riesgo. requiere un entrenamiento eficaz y una supervisión de los desarrolladores; y requiere estándares y procedimientos de código claros y coherentes. El efecto neto de SDL es una mejora importante en la seguridad de las aplicaciones, al tiempo que reduce el costo de desarrollar, implementar, mantener y retirar una aplicación. Aunque una explicación detallada del diseño y la implementación de SDL está fuera del ámbito de este documento, consulte el [ciclo de vida de desarrollo de seguridad de Microsoft](https://www.microsoft.com/security/sdl/default.aspx) para obtener instrucciones e información detalladas.


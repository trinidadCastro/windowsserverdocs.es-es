---
description: Más información acerca de cómo solucionar problemas de proxy de aplicación Web
title: Solución de problemas del Proxy de aplicación web
ms.author: kgremban
author: eross-msft
ms.date: 07/13/2016
ms.topic: article
ms.assetid: a2fef55d-747b-4e20-8f21-5f8807e7ef87
ms.openlocfilehash: 6c0ba93afe21c1a1c9c24b3986afa6628690197a
ms.sourcegitcommit: 65b6de6b44d41f1180c45db11cdd60cb2a093b46
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 12/10/2020
ms.locfileid: "97044893"
---
# <a name="troubleshooting-web-application-proxy"></a>Solución de problemas del Proxy de aplicación web

>Se aplica a: Windows Server 2016

**Este contenido es relevante para la versión local del proxy de aplicación Web. Para habilitar el acceso seguro a aplicaciones locales a través de la nube, consulte el [contenido del proxy de aplicación Azure ad](/azure/active-directory/manage-apps/application-proxy).**

En esta sección se proporcionan procedimientos de solución de problemas para el proxy de aplicación Web, incluidas las explicaciones de eventos y las soluciones. Hay tres lugares donde se muestran los errores:

-   En la consola de administrador de proxy de aplicación Web

    Los IDENTIFICADOres de evento que se enumeran en la consola de administrador se pueden ver en el Visor de eventos de Windows y las descripciones y soluciones correspondientes se encuentran a continuación.

    Abra visor de eventos y busque eventos relacionados con el proxy de aplicación web en **registros de aplicaciones y servicios**  >    >    >  Administración del proxy de **aplicación web**  >   de Microsoft Windows

    ![Información de administración, que se muestra en el Visor de eventos](media/Troubleshooting-Web-Application-Proxy/WebApplicationProxyTroubleshooting.png)

    Si es necesario, los registros detallados están disponibles al activar los registros de análisis y depuración y activar el registro de sesión del proxy de aplicación Web, que se encuentra en la Visor de eventos de Windows en \ Microsoft \ Windows \ Web Application proxy \ admin.

-   En errores de PowerShell

    Los eventos de los problemas encontrados durante la configuración se muestran en PowerShell.

    Todos los errores se presentan al usuario de PowerShell mediante mensajes de error estándar de PowerShell. Todos los comandos de PowerShell se registran como eventos. Todos los eventos que se producen en PowerShell se enumeran en la Visor de eventos de Windows con el número de identificación 12016 y se definen a continuación en la sección de PowerShell.

-   En el Analizador de procedimientos recomendados

    Estos eventos se describen en la [analizador de procedimientos recomendados para el proxy de aplicación web](assetId:///995f5cea-e334-4ce6-a14c-6a2d03c0c79a)

## <a name="powershell-messages"></a>Mensajes de PowerShell

|Evento o síntoma|Causa posible|Solución|
|--------------------|------------------|--------------|
|El certificado de confianza ("ADFS ProxyTrust- <WAP machine name> ") no es válido|La causa puede ser una de las siguientes:<p>-La máquina del proxy de aplicación estuvo inactiva durante demasiado tiempo.<br />-Desconexiones entre el proxy de aplicación web y AD FS<br />-Problemas de infraestructura de certificados<br />-Cambios en la máquina AD FS, o el proceso de renovación entre el proxy de aplicación web y el AD FS no se ejecutó como planeado cada 8 horas, por lo que necesita renovar la confianza<br />-El reloj de la máquina del proxy de aplicación web y el AD FS no están sincronizados.|Asegúrese de que los relojes estén sincronizados. Ejecute el cmdlet Install-WebApplicationProxy.|
|No se encontraron datos de configuración en AD FS|Esto puede deberse a que el proxy de aplicación web no se instaló por completo aún o debido a cambios en la base de datos AD FS o a daños en la base de datos.|Ejecutar el cmdlet Install-WebApplicationProxy|
|Se produjo un error cuando el proxy de aplicación web intentó leer la configuración desde AD FS.|Esto puede indicar que AD FS no está accesible o que AD FS ha detectado un problema interno al intentar leer la configuración de la base de datos de AD FS.|Compruebe que AD FS sea accesible y funcione correctamente.|
|Los datos de configuración almacenados en AD FS están dañados o el proxy de aplicación web no pudo analizarlos.<p>O BIEN<p>La aplicación web Proxywas no pudo recuperar la lista de usuarios de confianza de AD FS.|Esto puede ocurrir si los datos de configuración se modificaron en AD FS.|Reinicie la aplicación web Proxyservice. Si el problema persiste, ejecute el cmdlet Install-WebApplicationProxy.|

## <a name="administrator-console-events"></a>Eventos de Consola de administrador
Los siguientes eventos de la consola de administrador suelen ser indicativos de errores de autenticación, Tokes no válidos o cookies expiradas.

|Evento o síntoma|Causa posible|Solución|
|--------------------|------------------|--------------|
|11005<p>El proxy de aplicación web no pudo crear la clave de cifrado de cookies mediante el secreto de la configuración.|El parámetro "AccessCookiesEncryptionKey" de la configuración global cambió por el comando de PowerShell: Set-WebApplicationProxyConfiguration-RegenerateAccessCookiesEncryptionKey|No es necesario realizar ninguna acción. Se quitó la cookie problemática y el usuario se redirigió a STS para la autenticación.|
|12000<p>El proxy de aplicación web no pudo comprobar los cambios de configuración durante al menos 60 minutos|El proxy de aplicación web no puede tener acceso a la configuración del proxy de aplicación Web mediante el comando Get-WebApplicationProxyConfiguration/Application. Esto suele deberse a la falta de conectividad con AD FS o a la necesidad de renovar la confianza con AD FS.|Compruebe la conectividad con AD FS. Para ello, use el vínculo https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlAsegúrese de que hay confianza establecida entre el AD FS y el proxy de aplicación Web. Si estas soluciones no funcionan, ejecute el cmdlet Install-WebApplicationProxy.|
|12003<p>El proxy de aplicación web no pudo analizar la cookie de acceso.|Esto puede indicar que el proxy de aplicación web y el AD FS no están conectados o que no reciben la misma configuración.|Compruebe la conectividad con AD FS. Para ello, use el vínculo https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlAsegúrese de que hay confianza establecida entre el AD FS y el proxy de aplicación Web. Si estas soluciones no funcionan, ejecute el cmdlet Install-WebApplicationProxy.|
|12004<p>El proxy de aplicación web recibió una solicitud con una cookie de acceso no válida.|Este evento puede indicar que el proxy de aplicación web y el AD FS no están conectados o que no reciben la misma configuración.<p>Si ejecutó el parámetro "AccessCookiesEncryptionKey" en chaged con el comando de PowerShell Set-WebApplicationProxyConfiguration-RegenerateAccessCookiesEncryptionKey, este evento es normal y no requiere pasos de resolución.|Compruebe la conectividad con AD FS. Para ello, use el vínculo https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlAsegúrese de que hay confianza establecida entre el AD FS y el proxy de aplicación Web. Si estas soluciones no funcionan, ejecute el cmdlet Install-WebApplicationProxy.|
|12008<p>El proxy de aplicación web superó el número máximo de intentos de autenticación Kerberos permitidos en el servidor back-end.|Este evento puede indicar una configuración incorrecta entre el proxy de aplicación web y el servidor de aplicaciones de back-end, o un problema en la configuración de fecha y hora en ambos equipos.|El servidor back-end rechazó el vale de Kerberos creado por el proxy de aplicación Web. Compruebe que la configuración del proxy de aplicación web y del servidor de aplicaciones back-end está configurada correctamente.<p>Asegúrese de que la configuración de fecha y hora en el proxy de aplicación web y el servidor de aplicaciones back-end están sincronizadas.|
|12011<p>El proxy de aplicación web recibió una solicitud con una firma de cookie de acceso no válida.|Este evento puede indicar que el proxy de aplicación web y el AD FS no están conectados o que no reciben la misma configuración. Si ejecutó el parámetro "AccessCookiesEncryptionKey" en chaged con el comando de PowerShell Set-WebApplicationProxyConfiguration-RegenerateAccessCookiesEncryptionKey, este evento es normal y no requiere pasos de resolución.|Compruebe la conectividad con AD FS. Para ello, use el vínculo https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlAsegúrese de que hay confianza establecida entre el AD FS y el proxy de aplicación Web. Si estas soluciones no funcionan, ejecute el cmdlet Install-WebApplicationProxy.|
|12027<p>El proxy encontró un error inesperado al procesar la solicitud. El nombre proporcionado no es un nombre de cuenta formado correctamente.|Este evento puede indicar una configuración incorrecta entre el proxy de aplicación web y el servidor de controlador de dominio, o un problema en la configuración de fecha y hora en ambos equipos.|El controlador de dominio rechazó el vale de Kerberos creado por el proxy de aplicación Web. Compruebe que la configuración del proxy de aplicación web y el servidor de aplicaciones back-end están configuradas correctamente, especialmente la configuración de SPN. Asegúrese de que el proxy de aplicación web está unido a un dominio en el mismo dominio que el controlador de dominio para asegurarse de que el controlador de dominio establece confianza con el proxy de aplicación Web. Asegúrese de que la configuración de fecha y hora en el proxy de aplicación web y el controlador de dominio están sincronizadas.|
|13012<p>El proxy de aplicación web recibió una firma de token perimetral no válida||Asegúrese de que ha actualizado el proxy de aplicación web con [KB 2955164](https://go.microsoft.com/fwlink/?LinkId=400701).|
|13013<p>El proxy de aplicación web recibió una solicitud que contenía un token perimetral expirado.|El proxy de aplicación web y AD FS no tienen relojes sincronizados.|Sincronizar los relojes entre el proxy de aplicación web y el AD FS.|
|13014<p>El proxy de aplicación web recibió una solicitud con un token perimetral no válido. El token no es válido porque no se pudo analizar.|Esto puede indicar un problema con la configuración de AD FS.|Compruebe la configuración del AD FS y, si es necesario, restaure la configuración predeterminada.|
|13015<p>El proxy de aplicación web recibió una solicitud con una cookie de acceso expirada.|Esto podría indicar relojes que no están sincronizados.|Si está trabajando con un clúster de máquinas proxy de aplicación Web, asegúrese de que la fecha y la hora de los equipos estén sincronizadas.|
|13016<p>El proxy de aplicación web no puede recuperar un vale Kerberos en nombre del usuario porque no hay ningún UPN en el token perimetral o en la cookie de acceso.|Hay un problema con la configuración de STS.|Corrija la configuración de notificación de UPN en STS.|
|13019<p>El proxy de aplicación web no puede recuperar un vale Kerberos en nombre del usuario debido al siguiente error general de API|Este evento puede indicar una configuración incorrecta entre el proxy de aplicación web y el servidor de controlador de dominio, o un problema en la configuración de fecha y hora en ambos equipos.|El controlador de dominio rechazó el vale de Kerberos creado por el proxy de aplicación Web. Compruebe que la configuración del proxy de aplicación web y el servidor de aplicaciones back-end están configuradas correctamente, especialmente la configuración de SPN. Asegúrese de que el proxy de aplicación web está unido a un dominio en el mismo dominio que el controlador de dominio para asegurarse de que el controlador de dominio establece confianza con el proxy de aplicación Web. Asegúrese de que la configuración de fecha y hora en el proxy de aplicación web y el controlador de dominio están sincronizadas.|
|13020<p>El proxy de aplicación web no puede recuperar un vale Kerberos en nombre del usuario porque no está definido el SPN del servidor back-end.|Este evento puede indicar una configuración incorrecta entre el proxy de aplicación web y el servidor de controlador de dominio, o un problema en la configuración de fecha y hora en ambos equipos.|El controlador de dominio rechazó el vale de Kerberos creado por el proxy de aplicación Web. Compruebe que la configuración del proxy de aplicación web y el servidor de aplicaciones back-end están configuradas correctamente, especialmente la configuración de SPN. Asegúrese de que el proxy de aplicación web está unido a un dominio en el mismo dominio que el controlador de dominio para asegurarse de que el controlador de dominio establece confianza con el proxy de aplicación Web. Asegúrese de que la configuración de fecha y hora en el proxy de aplicación web y el controlador de dominio están sincronizadas.|
|13022<p>El proxy de aplicación web no puede autenticar al usuario porque el servidor back-end responde a los intentos de autenticación Kerberos con un error HTTP 401.|Este evento puede indicar una configuración incorrecta entre el proxy de aplicación web y el servidor de aplicaciones de back-end, o un problema en la configuración de fecha y hora en ambos equipos.|El servidor back-end rechazó el vale de Kerberos creado por el proxy de aplicación Web. Compruebe que la configuración del proxy de aplicación web y del servidor de aplicaciones back-end está configurada correctamente. Asegúrese de que la configuración de fecha y hora en el proxy de aplicación web y el servidor de aplicaciones back-end están sincronizadas.|
|13025<p>El cliente no presentó un certificado SSL en el proxy de aplicación Web.|Este evento puede indicar un problema en la configuración de fecha y hora.|Asegúrese de que la infraestructura de certificados sea válida y de que la fecha y la hora del proxy de aplicación web y el AD FS estén sincronizadas. Asegúrese de que la huella digital configurada para el proxy de aplicación web es la correcta.|
|13026<p>El cliente presentó un certificado SSL al proxy de aplicación Web, pero el certificado no es válido: el certificado no coincide con la huella digital.|Este evento puede indicar un problema en la configuración de fecha y hora.|Asegúrese de que la infraestructura de certificados sea válida y de que la fecha y la hora del proxy de aplicación web y el AD FS estén sincronizadas. Asegúrese de que la huella digital configurada para el proxy de aplicación web es la correcta.|
|13028<p>El proxy de aplicación web recibió una solicitud que contenía un token perimetral que todavía no es válido.|Este evento puede indicar un problema en la configuración de fecha y hora.|Asegúrese de que la infraestructura de certificados sea válida y de que la fecha y la hora del proxy de aplicación web y el AD FS estén sincronizadas.|
|13030<p>El cliente presentó un certificado SSL al proxy de aplicación Web, pero el proveedor de confianza no confía en la entidad de certificación que emitió el certificado de cliente.|Este evento puede indicar un problema en la configuración de fecha y hora.|Asegúrese de que la infraestructura de certificados sea válida y de que la fecha y la hora del proxy de aplicación web y el AD FS estén sincronizadas. Asegúrese de que la huella digital configurada para el proxy de aplicación web es la correcta.|
|13031<p>El cliente presentó un certificado SSL al proxy de aplicación Web, pero la cadena de certificados terminó en un certificado raíz que no es de confianza para el proveedor de confianza.|Este evento puede indicar un problema en la configuración de fecha y hora.|Asegúrese de que la infraestructura de certificados sea válida y de que la fecha y la hora del proxy de aplicación web y el AD FS estén sincronizadas. Asegúrese de que la huella digital configurada para el proxy de aplicación web es la correcta.|
|13032<p>El cliente presentó un certificado SSL al proxy de aplicación Web, pero el certificado no era válido para el uso solicitado.|Este evento puede indicar un problema en la configuración de fecha y hora.|Asegúrese de que la infraestructura de certificados sea válida y de que la fecha y la hora del proxy de aplicación web y el AD FS estén sincronizadas. Asegúrese de que la huella digital configurada para el proxy de aplicación web es la correcta.|
|13033<p>El cliente presentó un certificado SSL al proxy de aplicación Web, pero el certificado no estaba dentro de su período de validez al comprobar con el reloj actual del sistema o con la marca de tiempo del archivo firmado.|Este evento puede indicar un problema en la configuración de fecha y hora.|Asegúrese de que la infraestructura de certificados sea válida y de que la fecha y la hora del proxy de aplicación web y el AD FS estén sincronizadas. Asegúrese de que la huella digital configurada para el proxy de aplicación web es la correcta.|
|13034<p>El cliente presentó un certificado SSL al proxy de aplicación Web, pero el certificado no era válido.|Este evento puede indicar un problema en la configuración de fecha y hora.|Asegúrese de que la infraestructura de certificados sea válida y de que la fecha y la hora del proxy de aplicación web y el AD FS estén sincronizadas. Asegúrese de que la huella digital configurada para el proxy de aplicación web es la correcta.|

Los siguientes eventos de la consola de administrador suelen ser indicativos de problemas relacionados con la configuración, como el aprovisionamiento, la solicitud que no se realizan correctamente, los servidores back-end que no son accesibles y los desbordamientos del búfer.

|Evento o síntoma|Causa posible|Solución|
|--------------------|------------------|--------------|
|12019<p>El proxy de aplicación web no pudo crear un agente de escucha para la siguiente dirección URL.|Una posible causa del evento es que otro servicio está escuchando en la misma dirección URL.|El administrador debe asegurarse de que nadie escucha o se enlaza con las mismas direcciones URL. Para comprobarlo, ejecute el comando: netsh http show urlacl. Si otro componente que se ejecuta en la máquina del proxy de aplicación Web usa esta dirección URL, quítela o use una dirección URL diferente para publicar las aplicaciones mediante el proxy de aplicación Web.|
|12020<p>El proxy de aplicación web no pudo crear una reserva para la siguiente dirección URL.|Una posible causa del evento es que otro servicio tiene una reserva en la misma dirección URL.|El administrador debe asegurarse de que nadie se enlaza con las mismas direcciones URL. Para comprobarlo, ejecute el comando: netsh http show urlacl. Si otro componente que se ejecuta en la máquina del proxy de aplicación Web usa esta dirección URL, quítela o use una dirección URL diferente para publicar las aplicaciones mediante el proxy de aplicación Web.|
|12021<p>El proxy de aplicación web no pudo enlazar el certificado de servidor SSL. Se aplicaron todas las demás opciones de configuración.|No se puede crear y establecer un registro de configuración de datos del certificado SSL.|Asegúrese de que las huellas digitales de certificado que están configuradas para Proxyapplications de aplicación Web estén instaladas en todas las máquinas del proxy de aplicación web con una clave privada en el almacén del equipo local.|
|13001<p>El certificado de servidor SSL presentado al proxy de aplicación web por el servidor back-end no es válido; el certificado no es de confianza.|Se encontraron uno o varios errores en el certificado Capa de sockets seguros (SSL) enviado por el servidor. Esto podría indicar que el servidor back-end proporcionó un SSL que no era válido o que no hay ninguna relación de confianza entre el proxy de aplicación web y el servidor back-end.|Validar un certificado SSL de servidor back-end. Asegúrese de que la máquina del proxy de aplicación web esté configurada con las CA raíz correctas para confiar en el certificado del servidor back-end.|
|13006|Cuando el código de error es 0x80072ee7, el failurrre se debe a la imposibilidad de resolver la dirección URL del servidor back-end. Otros códigos de error se describen en [https://msdn.microsoft.com/library/windows/desktop/aa384110(v=vs.85)](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn280944(v=ws.11))|Compruebe que la dirección URL del servidor back-end es correcta y que su nombre se puede resolver correctamente desde el equipo del proxy de aplicación Web.|
|13007<p>No se recibió la respuesta HTTP del servidor back-end en el intervalo esperado.|La solicitud del servidor back-end agotó el tiempo de espera o es lenta o no responde.|Compruebe la configuración del servidor back-end. Si es muy lento, Compruebe la conectividad con el servidor back-end y también considere la posibilidad de cambiar el cmdlet de parámetro de configuración global del proxy de aplicación web para InactiveTransactionsTimeoutSec.|

## <a name="see-also"></a>Consulte también
[Novedades en el proxy de aplicación web en Windows Server 2016](web-application-proxy-windows-server.md) 
 [Trabajar con el proxy de aplicación web](assetId:///b607b717-2172-4271-98d1-fa8162e0bb2e)

